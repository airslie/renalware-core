---
title: Creating a report
---

To create a custom report you first define a SQL view (or materialised view) in Renalware's
Postgres database, and then add an row manually to the system_view_metadata table to tell
Renalware about it.

## A simple example

### 1. Create a SQL view

:::tip

We recommend you store your custom views in your hospital-specific schema eg `renalware_kch`,
and prefix the view name with  `reporting` to make it easier to locate.

Its a good idea to test reports in a UAT/test environment before promoting to production
:::

In a SQL client like DBeaver, [create a SQL view](https://www.postgresql.org/docs/current/sql-createview.html). In this contrived example we will create a
SQL view that finds all patients aged 40 or under:

```
CREATE OR REPLACE VIEW renalware_kch.reporting_patients_under_40 AS
 SELECT
    P.secure_id,
    (upper(P.family_name::text) || ', ') || p.given_name AS patient_name,
    P.born_on as dob,
    EXTRACT(years from AGE(P.born_on)) as age
  FROM renalware.patients P
  WHERE AGE(P.born_on) <= '10 years';
```

Note
- we have created a `patient_name` data item by concatenating `given_name` and `family_name` (in future versions of Renalware this column will be autogenerated and available as `patients.name`).
- include the `secure_id` column if you would like to be able to click on the patient_name in the report to view the patient's details.
- all returned columns are automatically sortable, although values which are numbers inside strings (eg "123" as opposed to 123) will not sort numerically unless casted to eg an integer or float using eg `::integer`. In the example, age (eg 24) is already a number so we don't need to cast it for it to sort. However it is actually returned as a float (eg as 24.0) so we have cast it here to an integer so it appears as eg 24 on the report.


### 2. Let Renalware know about the view

Add a rows to the `system_view_metadata` table to describe the report.
A note on the columns:
- `schema_name` should be the Postgres schema where you created the report eg `renalware_kch`
- `view_name` eg `reporting_patients_under_40`
- `scope` needs to be `patients`
- `title` is what appears in the list of reports, so should not be too long
- `description` appears on the page with the report data, so you can be more verbose here if useful
- `category` must be `report`
- `sub_category` is a custom string like 'Housekeeping' or 'HD' - something you can use to group related reports
- `patient_landing_page` can be one of a pre-defined list of values and determines where in Renalware you 'land' when clicking on the patient's name in the report. See 'Possible values for 'patient_landing_page'
- `created_at` and `updated_at` are just timestamps and you can use the postgres CURRENT_TIMESTAMP macro

Here is the SQL to add our report:

```
INSERT INTO renalware.system_view_metadata
(
  schema_name,
  view_name,
  scope,
  title,
  description,
  category,
  created_at,
  updated_at
)
VALUES
(
  'renalware',
  'reporting_patients_under_60',
  'patients',
  'Patients under 40',
  'Patients under 40 years of age',
  'report',
  current_timestamp,
  current_timestamp
);
```


#### Possible values for 'patient_landing_page'

```
accesses
admissions
akcc
clinic_visits
clinical
clinical_summary
demographics
events
hd
letters
low_clearance
modalities
pathology
pd
prescriptions
problems
renal
transplants_donor
transplants_recipient
virology
```

![Example report](/img/example-report.jpg)

:::note
You can click on any column heading to sort the table
:::
