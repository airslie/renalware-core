{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.14.2/.schema/devbox.schema.json",
  "packages": {
    "postgresql": "16",
    "libyaml": {
      "version": "latest",
      "outputs": ["dev"],
    },
    "pkg-config": "latest",
    "gcc":        "latest",
    "gnumake":    "latest",
    "libpq": {
      "version": "latest",
      "outputs": ["dev"],
    },
    "lsof":           "latest",
    "wkhtmltopdf":    "latest",
    "yarn":           "latest",
    "nodejs":         "22.11.0",
    "imagemagickBig": "latest",
    "vips": {
      "version": "latest",
      "outputs": ["dev", "bin", "out"],
    },
    "ghostscript": {
      "version": "latest",
      "outputs": ["fonts", "out"],
    },
    "playwright-driver.browsers": "",
    "pandoc":                     "latest",
    "ruby":                       "3.4.3",
  },
  "env": {
    "SETUP_COMPLETE":           "$DEVBOX_PROJECT_ROOT/.devbox/.setup-complete",
    "PLAYWRIGHT_BROWSERS_PATH": "$DEVBOX_PACKAGES_DIR",
  },
  "shell": {
    "init_hook": [
      "[ -f \"$SETUP_COMPLETE\" ] || bundle check || bundle",
    ],
    "scripts": {
      "purge": [
        "rm -rf $PGDATA && mkdir -p $PGDATA",
        "rm -f \"$SETUP_COMPLETE\"",
      ],
      "setup": [
        "[ -f \"$SETUP_COMPLETE\" ] && echo Nothing to do, run: 'devbox run reset' to re-initialize the project && exit 0",
        "initdb",
        "echo \"CREATE ROLE renalware WITH LOGIN PASSWORD 'renalware' SUPERUSER;\" | postgres --single postgres",
        "devbox services start postgresql",
        "git submodule update --init --recursive",
        "bundle check || bundle",
        "yarn",
        "bin/wait-for-port 5432 30",
        "rails db:setup",
        "overcommit --force",
        "touch \"$SETUP_COMPLETE\"",
        "devbox services down",
        "echo \"Setup complete!\"",
        "echo \"Now run `devbox services up` to start process-compose\"",
      ],
      "reset": [
        "devbox run purge",
        "devbox run setup",
      ],
      "update": [
        "bundle check || bundle",
        "rails db:migrate",
        "rails db:migrate RAILS_ENV=test",
      ],
      "test": [
        "rails test",
      ],
    },
  },
}
