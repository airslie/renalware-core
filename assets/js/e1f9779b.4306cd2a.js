"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[737],{7993:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Reporting/using-a-materialised-view","title":"Using materialised views","description":"Standard SQL views query the database every time you access the them. If the view is \'expensive\' -","source":"@site/docs/02-Reporting/02-using-a-materialised-view.md","sourceDirName":"02-Reporting","slug":"/Reporting/using-a-materialised-view","permalink":"/Reporting/using-a-materialised-view","draft":false,"unlisted":false,"editUrl":"https://github.com/airslie/renalwarev2/tree/main/documentation/docs/02-Reporting/02-using-a-materialised-view.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Using materialised views"},"sidebar":"tutorialSidebar","previous":{"title":"Creating a report","permalink":"/Reporting/create a report"},"next":{"title":"Adding filters","permalink":"/Reporting/adding-filters"}}');var n=i(4848),a=i(8453);const s={title:"Using materialised views"},o=void 0,l={},d=[{value:"1. Creating the materialised view",id:"1-creating-the-materialised-view",level:2},{value:"2. Tell Renalware when to refresh the materialised view",id:"2-tell-renalware-when-to-refresh-the-materialised-view",level:3}];function h(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"Standard SQL views query the database every time you access the them. If the view is 'expensive' -\nfor example it has a lot of joins or it queries large tables - then it may be slow to run, or\nimpact database performance for other users. Materialised views can be useful in this instance as\nthey have to be refreshed on demand (manually or on a schedule, perhaps overnight), and the data in them remains cached\n(as if they were tables and not views) until the next time they are refreshed. This makes them\nfast to access as the data is effectively cached."}),"\n",(0,n.jsx)(t.p,{children:"Another scenario where materialised views are useful is in displaying data up to particular point in\ntime but not beyond - for example the number of HD sessions yesterday (if the materialised view is refreshed\nat midnight) or the number of letters created last month (if the materialised view is refreshed on the last day of the\nprevious month)."}),"\n",(0,n.jsx)(t.p,{children:"Follow the same procedure as creating a normal report but with these differences:"}),"\n",(0,n.jsx)(t.h2,{id:"1-creating-the-materialised-view",children:"1. Creating the materialised view"}),"\n",(0,n.jsxs)(t.p,{children:["There is slight difference to the ",(0,n.jsx)(t.a,{href:"https://www.postgresql.org/docs/current/sql-creatematerializedview.html",children:"syntax"})," used to create the view"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"CREATE materialized VIEW reporting_patients_under_40\n  ....\n"})}),"\n",(0,n.jsx)(t.h3,{id:"2-tell-renalware-when-to-refresh-the-materialised-view",children:"2. Tell Renalware when to refresh the materialised view"}),"\n",(0,n.jsxs)(t.p,{children:["When adding the row to ",(0,n.jsx)(t.code,{children:"system_view_metadata"})," to tell Renalware about the view (as specified in Create a Report) include these additional columns:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"materialized"})," true"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"refresh_schedule"})," a cron-style expression (eg ",(0,n.jsx)(t.code,{children:"0 * * * *"})," for every hour on the hour) defining when the data in the materialised view is refreshed - use ",(0,n.jsx)(t.a,{href:"https://crontab.guru",children:"https://crontab.guru"})]}),"\n"]})]})}function c(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},8453:(e,t,i)=>{i.d(t,{R:()=>s,x:()=>o});var r=i(6540);const n={},a=r.createContext(n);function s(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);