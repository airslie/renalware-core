"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[327],{3238:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"Nags/nags","title":"Creating Nags","description":"Patient nags are alerts that appear at the top of a patient\'s pages to indicate missing or","source":"@site/docs/04-Nags/01-nags.md","sourceDirName":"04-Nags","slug":"/Nags/nags","permalink":"/Nags/nags","draft":false,"unlisted":false,"editUrl":"https://github.com/airslie/renalwarev2/tree/main/documentation/docs/04-Nags/01-nags.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Creating Nags"},"sidebar":"tutorialSidebar","previous":{"title":"Example NHS numbers","permalink":"/Testing/example_nhs_numbers"},"next":{"title":"Accessibility","permalink":"/Accessibility/"}}');var s=t(4848),a=t(8453);const r={title:"Creating Nags"},d="Patient Nags",l={},c=[{value:"Nag SQL functions",id:"nag-sql-functions",level:2},{value:"Nag Severity",id:"nag-severity",level:3},{value:"Nag Definitions",id:"nag-definitions",level:2},{value:"Caching",id:"caching",level:2},{value:"Trouble shooting",id:"trouble-shooting",level:2},{value:"Nag not appearing",id:"nag-not-appearing",level:3},{value:"Nag not dismissing once issue resolved",id:"nag-not-dismissing-once-issue-resolved",level:3},{value:"Nag not changing after udpating the SQL function behind it",id:"nag-not-changing-after-udpating-the-sql-function-behind-it",level:3}];function o(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"patient-nags",children:"Patient Nags"})}),"\n",(0,s.jsx)(n.p,{children:"Patient nags are alerts that appear at the top of a patient's pages to indicate missing or\nout-of-date data - for example they have not had a clinical frailty score in the last 180 days."}),"\n",(0,s.jsx)(n.h2,{id:"nag-sql-functions",children:"Nag SQL functions"}),"\n",(0,s.jsx)(n.p,{children:"Nags are implemented as discrete SQL functions in PostgreSQL. The function must have the following\nsignature, accepting on input (p_id) and in the function populating 2 variables to be returned\nto Renalware (hence the OUT modifier):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CREATE OR REPLACE FUNCTION patient_nag_<name_of_nag>(\n    p_id integer,\n    OUT out_severity system_nag_severity,\n    OUT out_date date\n    OUT out_value text\n)\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Argument"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"p_id"})}),(0,s.jsx)(n.td,{children:"the patient's primary key id in the patient's table (this is not an NHS or hospital number)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"out_severity"})}),(0,s.jsx)(n.td,{children:"this variable must be populated with one of the values below"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"out_date"})}),(0,s.jsx)(n.td,{children:"optional date eg an event date"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"out_value"})}),(0,s.jsx)(n.td,{children:"optional value eg some value from an event"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"nag-severity",children:"Nag Severity"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Name"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"'none'"})}),(0,s.jsx)(n.td,{children:"the nag will not be displayed"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"'info'"})}),(0,s.jsx)(n.td,{children:"the nag will always be displayed (provided value or date are not null) for info only. Arguably not a nag in this instance."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"'low'"})}),(0,s.jsx)(n.td,{children:"nag will display with a yellow background"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"'medium'"})}),(0,s.jsx)(n.td,{children:"nag will display with an orange background"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"'high'"})}),(0,s.jsx)(n.td,{children:"nag will display with a red background"})]})]})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"For an example nag search the code for patient_nag_clinical_frailty_score."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"nag-definitions",children:"Nag Definitions"}),"\n",(0,s.jsx)(n.p,{children:"For a nag to appear, it must have an entry in the nag_definitions table. You can edit this in the\nAdmin UI if you are are superadmin, or directly through in the database table.\nWhen adding a nag in the UI, your function will only appear in the dropdown if it is named correctly\n(see above)."}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Column"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"scope"})}),(0,s.jsx)(n.td,{children:"There are patient and user scope nags. Only patient scope nags are currently implenented."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"importance"})}),(0,s.jsx)(n.td,{children:"An integer where the lowest number appears first when > 1 nag is dislpayed"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"description"})}),(0,s.jsx)(n.td,{children:"Does not appear on screen but can be used remind you what the nag does"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"hint"})}),(0,s.jsx)(n.td,{children:"Appears when hovering over the nag"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sql_function_name"})}),(0,s.jsx)(n.td,{children:"The function described above"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"title"})}),(0,s.jsx)(n.td,{children:"A string that appears in the nag e.g. as a prefix to the content eg 'CFS' in 'CFS: 01-Apr-2020'"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"enabled"})}),(0,s.jsx)(n.td,{children:"Set to false to hide the nag"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"relative_link"})}),(0,s.jsxs)(n.td,{children:["If present, the title will become a link a location in renalware. Use a placeholder for patient id. For example if the nag shold be resolved byu adding an event to the patient, use ",(0,s.jsx)(n.code,{children:"patients/:id/events"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"always_expire_cache_after_minutes"})}),(0,s.jsx)(n.td,{children:"Nags cache (to improve performance) until their cause is resolved or until this number of minutes has elapsed, after which the SQL funcion is called again to refresh the on-screen nag. You can lower this number if nags are not dismissing after the user has resolved the nag cause"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"caching",children:"Caching"}),"\n",(0,s.jsx)(n.p,{children:"Once rendered, a nag is cached until:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["the patient's updated_at date changes (ie the patient record has been ",(0,s.jsx)(n.code,{children:"touched"})," in some way,\nperhaps by an event being added)"]}),"\n",(0,s.jsx)(n.li,{children:"the nag definition has been updated (resulting in its updated_at datetime changing)"}),"\n",(0,s.jsx)(n.li,{children:"the nag cache expires - TODO"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Caching nags is useful because they can be 'expensive' in terms of processing time and therefore affect page rendering times."}),"\n",(0,s.jsx)(n.h2,{id:"trouble-shooting",children:"Trouble shooting"}),"\n",(0,s.jsx)(n.h3,{id:"nag-not-appearing",children:"Nag not appearing"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Check you are not returning 'none' in the severity from your function."}),"\n",(0,s.jsx)(n.li,{children:"Check the nag_definition is not enabled=false."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"nag-not-dismissing-once-issue-resolved",children:"Nag not dismissing once issue resolved"}),"\n",(0,s.jsx)(n.p,{children:"It is possible the action the user took did not cause the patient record to be touched. Please report this as a bug.\nTo remendy the situation, please update the nag_definition updated_at by using the Touch button under the Admin -> Nags, or manually in the database.\nYou can also touch the patient in Renalware by e.g. updating their demographics."}),"\n",(0,s.jsxs)(n.p,{children:["If the problem happens regularly you can update ",(0,s.jsx)(n.code,{children:"nag_definitions.always_expire_cache_after_minutes"})," to be a lower number."]}),"\n",(0,s.jsx)(n.h3,{id:"nag-not-changing-after-udpating-the-sql-function-behind-it",children:"Nag not changing after udpating the SQL function behind it"}),"\n",(0,s.jsxs)(n.p,{children:["Be sure to update ",(0,s.jsx)(n.code,{children:"nag_definitons.updated_at"})," to invalidate the cache for this nag."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>d});var i=t(6540);const s={},a=i.createContext(s);function r(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);